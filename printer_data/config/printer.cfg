[include KAMP_Settings.cfg]
[include Shaketune.cfg]
[include mainsail.cfg]
[include macros.cfg]
[include leds.cfg]
[exclude_object]

[force_move]
enable_force_move: true

##############################
##      Serial VT.1884      ##
##############################

[mcu]
canbus_uuid: 875a06d67fc4

[mcu EBBCan]
canbus_uuid: efcf572c75b9

[printer]
kinematics: corexy
max_velocity: 550 
max_accel: 5000 #Max 4000
max_z_velocity: 20 			#Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0

[temperature_sensor MCU]
sensor_type: temperature_mcu

[temperature_sensor Pi]
sensor_type: temperature_host


#####################################################################
# 	X/Y Stepper Settings
#####################################################################

## X Stepper on Motor1(B Motor) Left
[stepper_x]
step_pin: PE2
dir_pin: PE1
enable_pin: !PE4
microsteps: 16
rotation_distance: 40
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 35   #Max 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_x]
uart_pin: PE3
interpolate: True
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_HEND: 3
driver_HSTRT: 0
diag_pin: ^PF3
driver_SGTHRS: 68 #most sens 255/0 least sens

## Y Stepper on Motor2 (A Motor) Right
[stepper_y]
step_pin: PE6
dir_pin: PE5
enable_pin: !PC14
microsteps: 16
rotation_distance: 40
full_steps_per_rotation:200
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_min: 0
position_endstop: 305
position_max: 307
homing_speed: 35  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_y]
uart_pin: PC13
interpolate: True
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0
driver_PWM_AUTOGRAD: True
driver_PWM_AUTOSCALE: True
driver_HEND: 3
driver_HSTRT: 0
diag_pin: ^PF4
driver_SGTHRS: 68 #most sens 255/0 least sens

#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left on MOTOR3_A
[stepper_z]
step_pin: PG9
dir_pin: PD7
enable_pin: !PG11
rotation_distance: 4    
microsteps: 32
endstop_pin: probe:z_virtual_endstop
#position_endstop: -0.5
position_max: 250
position_min: -2.5
homing_speed: 8.0 #10 is a recommended max.
second_homing_speed: 3
homing_retract_dist: 0

[tmc2209 stepper_z]
uart_pin: PG10
interpolate: true
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Rear  on Motor4
[stepper_z1]
step_pin: PB4
dir_pin: PB3
enable_pin: !PB6
rotation_distance: 4  
microsteps: 32

[tmc2209 stepper_z1]
uart_pin: PB5
interpolate: true
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Front Right on Motor5
[stepper_z2]
step_pin: PG13
dir_pin: PG12
enable_pin: !PG15
rotation_distance: 4  
microsteps: 32

[tmc2209 stepper_z2]
uart_pin: PG14
interpolate: true
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
# 	Extruder
#####################################################################

[extruder]
step_pin: EBBCan:gpio18
dir_pin: EBBCan:gpio19
enable_pin: !EBBCan:gpio17
rotation_distance: 13.21048901575
gear_ratio: 50:17             
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBBCan:gpio7
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: EBBCan:gpio27
min_temp: 10
max_temp: 270
max_power: 1.0
min_extrude_temp: 170
#control = pid
#pid_kp = 26.213
#pid_ki = 1.304
#pid_kd = 131.721
pressure_advance: 0.04
#pressure_advance_smooth_time: 0.040
max_extrude_cross_section: 5

[tmc2209 extruder]
uart_pin: EBBCan:gpio20
interpolate: true
run_current: 0.650
stealthchop_threshold: 999999

[filament_switch_sensor my_sensor]
switch_pin: !EBBCan:gpio21
pause_on_runout: False #pause handled by macro
event_delay: 3.0
runout_gcode:
  FILAMENT_RUNOUT
insert_gcode:
  INSERT_FILAMENT

[fan]
pin: EBBCan:gpio13

[heater_fan hotend_fan]
pin: EBBCan:gpio14
heater: extruder
heater_temp: 50.0

#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
heater_pin: PA0
sensor_type: Generic 3950
sensor_pin: PB1
max_power: 1
min_temp: 0
max_temp: 115
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
# 	Probe
#####################################################################

[mcu scanner]
canbus_uuid: 466800cb834b #cf3c7809295d 

[scanner]
mcu: scanner            
x_offset: 0                          
y_offset: 25                         
backlash_comp: 0.00361
sensor: cartographer
sensor_alt: carto  
mesh_runs: 2

[bed_mesh]
zero_reference_position: 150, 150    
speed: 200
horizontal_move_z: 5
mesh_min: 15, 25
mesh_max: 240, 240
probe_count: 30, 30
algorithm: bicubic

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105

[adxl345]
cs_pin: scanner:PA3
spi_bus: spi1

[resonance_tester]
accel_chip: adxl345
probe_points:
    150, 150, 20
accel_per_hz: 100
sweeping_accel: 400
sweeping_period: 0

#####################################################################
# 	Fan Control
#####################################################################

[heater_fan Electronics1]
pin: PF7
heater: extruder
heater_temp: 50.0

[heater_fan Electronics2]
pin: PF9
heater: extruder
heater_temp: 50.0

[fan_generic Nevermore]
pin: PA4
#heater: extruder
#heater_temp: 50.0

#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[safe_z_home]
home_xy_position:150,150
speed:100
z_hop:10

[z_tilt]
z_positions:
   -50, 18
   150, 348
   350, 18
points:
   30, 5
   150, 245
   270, 5
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner model default]
#*# model_coef = 1.4597490514601663,
#*# 	1.908588186880574,
#*# 	0.7944627735700058,
#*# 	0.3780186091190885,
#*# 	0.28824663197552675,
#*# 	0.1770945304998936,
#*# 	-0.17053554771297358,
#*# 	-0.12534401584666083,
#*# 	0.17860131662557535,
#*# 	0.11470830942955461
#*# model_domain = 3.1926783120549797e-07,3.299669491407701e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 27.639823
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.093
#*# pid_ki = 0.958
#*# pid_kd = 76.277
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 40.630
#*# pid_ki = 1.584
#*# pid_kd = 260.542
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1250
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.125
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 68.6
#*# shaper_type_y = ei
#*# shaper_freq_y = 62.2
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.039478, -0.024139, -0.040523, -0.024088, -0.035601, -0.030984, -0.026420, -0.033956, -0.024205, -0.025293, -0.026430, -0.025324, -0.034752, -0.021829, -0.040238, -0.030217, -0.028411, -0.027975, -0.026156, -0.028546, -0.027006, -0.029729, -0.033131, -0.030897, -0.032756, -0.031350, -0.035079, -0.039610, -0.034649, -0.039761
#*# 	-0.019242, -0.020105, -0.025058, -0.022947, -0.024627, -0.024235, -0.023789, -0.021559, -0.019921, -0.017863, -0.019489, -0.023118, -0.009131, -0.008284, -0.009860, -0.017883, -0.019539, -0.019773, -0.019744, -0.020946, -0.020073, -0.021912, -0.023280, -0.019985, -0.024205, -0.025043, -0.024726, -0.026304, -0.027551, -0.031178
#*# 	-0.014252, -0.015232, -0.020611, -0.014814, -0.022301, -0.018745, -0.016743, -0.015880, -0.016502, -0.013379, -0.016329, -0.020548, -0.014336, -0.013373, -0.009108, -0.016890, -0.013126, -0.014227, -0.015677, -0.018910, -0.019430, -0.016908, -0.015278, -0.014109, -0.016666, -0.018878, -0.018149, -0.018976, -0.021484, -0.021922
#*# 	-0.011919, -0.010593, -0.013000, -0.011258, -0.011056, -0.011233, -0.009654, -0.008840, -0.006958, -0.005795, -0.005288, -0.007167, 0.002999, 0.004844, -0.007839, -0.005808, -0.004578, -0.005143, -0.011212, -0.009912, -0.015299, -0.009455, -0.005388, -0.004075, -0.006806, -0.009968, -0.009288, -0.009230, -0.012272, -0.013020
#*# 	-0.001296, 0.008238, -0.000688, 0.006471, 0.006005, 0.006259, 0.008796, 0.008290, 0.011493, 0.012540, 0.013590, 0.011634, 0.008425, 0.009877, 0.008205, 0.010375, 0.012894, 0.012241, 0.005947, 0.008075, 0.008475, 0.006939, 0.010014, 0.013968, 0.011521, 0.009127, 0.007908, 0.010494, 0.006990, 0.008009
#*# 	0.010616, 0.019679, 0.017793, 0.024878, 0.024284, 0.025362, 0.026992, 0.028439, 0.028901, 0.030175, 0.031268, 0.030335, 0.029292, 0.028779, 0.029115, 0.031756, 0.033877, 0.033727, 0.030444, 0.026478, 0.033399, 0.032447, 0.026295, 0.031448, 0.028981, 0.029225, 0.025011, 0.029349, 0.025378, 0.028005
#*# 	0.014923, 0.026590, 0.027836, 0.031374, 0.034481, 0.033521, 0.036251, 0.041036, 0.040218, 0.043462, 0.041656, 0.042497, 0.040130, 0.040189, 0.040267, 0.042296, 0.044645, 0.044770, 0.044011, 0.038349, 0.053088, 0.054247, 0.044448, 0.042231, 0.042444, 0.041412, 0.038771, 0.041051, 0.039513, 0.044003
#*# 	0.008281, 0.019202, 0.019012, 0.025444, 0.026349, 0.025882, 0.030300, 0.033757, 0.035971, 0.035048, 0.034223, 0.032821, 0.032954, 0.032149, 0.032810, 0.035635, 0.036702, 0.036325, 0.036259, 0.040124, 0.052725, 0.054964, 0.041332, 0.040152, 0.038004, 0.037385, 0.035881, 0.035496, 0.038100, 0.042710
#*# 	-0.011463, -0.002562, 0.002181, 0.003691, 0.006058, 0.008624, 0.009328, 0.015306, 0.012346, 0.014082, 0.014537, 0.010348, 0.011642, 0.010303, 0.012560, 0.013496, 0.015472, 0.014507, 0.017122, 0.022210, 0.033932, 0.034168, 0.025387, 0.023347, 0.021283, 0.022030, 0.021389, 0.021835, 0.022658, 0.028917
#*# 	-0.035006, -0.026235, -0.025612, -0.021057, -0.018885, -0.016028, -0.013245, -0.011068, -0.010974, -0.010972, -0.011014, -0.011253, -0.012176, -0.012646, -0.011220, -0.008821, -0.006163, -0.007922, -0.004785, 0.001778, 0.006163, 0.004442, 0.001623, 0.001622, 0.000170, -0.000198, -0.000629, 0.000900, 0.004716, 0.006932
#*# 	-0.051154, -0.041908, -0.044399, -0.034993, -0.037969, -0.030672, -0.032571, -0.032780, -0.026431, -0.030978, -0.026129, -0.028605, -0.029767, -0.029519, -0.028866, -0.024327, -0.024457, -0.025873, -0.024089, -0.017648, -0.007676, -0.015935, -0.014327, -0.012104, -0.013617, -0.011656, -0.013241, -0.012513, -0.010317, -0.009959
#*# 	-0.059941, -0.050288, -0.048449, -0.046170, -0.044925, -0.044363, -0.042803, -0.041750, -0.039107, -0.037029, -0.037318, -0.036870, -0.037398, -0.036323, -0.034412, -0.032121, -0.029644, -0.033365, -0.031923, -0.028303, -0.018277, -0.025265, -0.020984, -0.017561, -0.017888, -0.019828, -0.019958, -0.020894, -0.020069, -0.019797
#*# 	-0.062884, -0.052802, -0.053298, -0.044845, -0.046239, -0.049216, -0.045748, -0.046239, -0.041484, -0.040828, -0.042168, -0.039355, -0.041923, -0.037657, -0.036239, -0.034725, -0.032930, -0.033377, -0.030899, -0.031127, -0.022175, -0.026348, -0.022086, -0.016984, -0.019895, -0.017814, -0.020660, -0.024468, -0.023565, -0.024410
#*# 	-0.055274, -0.045952, -0.043665, -0.041076, -0.041715, -0.041231, -0.039754, -0.039632, -0.037079, -0.035576, -0.033160, -0.036113, -0.035008, -0.030576, -0.030558, -0.025249, -0.023741, -0.022431, -0.021703, -0.022508, -0.013815, -0.017325, -0.014003, -0.009013, -0.011224, -0.013939, -0.015168, -0.016982, -0.019893, -0.024023
#*# 	-0.046061, -0.036727, -0.036790, -0.033913, -0.030889, -0.035015, -0.030683, -0.030627, -0.028944, -0.025393, -0.026920, -0.024146, -0.024544, -0.022895, -0.019767, -0.015952, -0.012662, -0.009336, -0.007443, -0.008351, -0.004686, -0.006786, -0.004450, 0.000293, 0.000903, -0.004634, -0.004086, -0.006981, -0.008670, -0.013275
#*# 	-0.041573, -0.035625, -0.035542, -0.032163, -0.032014, -0.028736, -0.028038, -0.025992, -0.024072, -0.022602, -0.021484, -0.024220, -0.021143, -0.017862, -0.016004, -0.008878, -0.005797, -0.002697, 0.000778, -0.000193, 0.003830, -0.000495, 0.000321, 0.004657, 0.003740, 0.002521, 0.001414, -0.001468, -0.004119, -0.008477
#*# 	-0.043015, -0.038445, -0.037172, -0.035026, -0.030619, -0.029556, -0.028478, -0.025574, -0.026429, -0.021168, -0.021807, -0.021668, -0.022579, -0.020954, -0.015211, -0.008734, -0.003718, 0.001098, 0.004302, 0.006811, 0.008501, 0.001429, 0.001846, 0.004310, 0.004665, 0.003886, 0.001031, -0.000381, -0.004651, -0.006776
#*# 	-0.048220, -0.040396, -0.039684, -0.036812, -0.035176, -0.033141, -0.031023, -0.028816, -0.026525, -0.024196, -0.026243, -0.025319, -0.027297, -0.024498, -0.018497, -0.008927, -0.006259, -0.001466, 0.001768, 0.006150, 0.006187, 0.001653, -0.000661, 0.002402, 0.000627, -0.001478, -0.003005, -0.004728, -0.007095, -0.009855
#*# 	-0.061053, -0.053094, -0.051098, -0.047820, -0.046078, -0.042911, -0.041465, -0.039406, -0.036881, -0.035443, -0.035026, -0.034818, -0.035131, -0.031179, -0.026375, -0.017185, -0.015261, -0.013397, -0.009291, -0.005742, -0.003805, -0.006675, -0.013288, -0.007969, -0.011199, -0.012565, -0.014096, -0.015664, -0.015908, -0.018819
#*# 	-0.064787, -0.055934, -0.054622, -0.049641, -0.048301, -0.047012, -0.045729, -0.042761, -0.040580, -0.039299, -0.035366, -0.036751, -0.035781, -0.032526, -0.028099, -0.021975, -0.017164, -0.016181, -0.012222, -0.008887, -0.007459, -0.012424, -0.013667, -0.013013, -0.015698, -0.018830, -0.021966, -0.022611, -0.022346, -0.026478
#*# 	-0.056075, -0.048743, -0.048514, -0.041787, -0.040604, -0.039475, -0.037109, -0.035453, -0.033097, -0.033106, -0.030884, -0.028172, -0.029033, -0.025894, -0.022449, -0.015979, -0.010034, -0.007102, -0.004887, -0.004209, -0.006831, -0.006694, -0.011514, -0.010666, -0.013538, -0.014620, -0.015057, -0.018996, -0.015961, -0.018237
#*# 	-0.035854, -0.028423, -0.028234, -0.024233, -0.021014, -0.017720, -0.017555, -0.017570, -0.015688, -0.015701, -0.012155, -0.011492, -0.010543, -0.009985, -0.009047, -0.004222, 0.000117, 0.005513, 0.008222, 0.008037, 0.006086, 0.005064, 0.001977, 0.001166, -0.000222, -0.000469, -0.001413, -0.002566, -0.001947, -0.002461
#*# 	-0.013123, -0.007381, -0.006274, -0.002486, 0.001526, 0.003934, 0.004206, 0.006033, 0.007082, 0.008779, 0.010030, 0.010432, 0.011092, 0.011382, 0.010698, 0.013213, 0.018822, 0.023081, 0.024448, 0.025532, 0.026867, 0.027532, 0.022117, 0.023218, 0.022165, 0.020296, 0.020850, 0.020007, 0.019218, 0.018669
#*# 	-0.002252, 0.005221, 0.006094, 0.009906, 0.012667, 0.015064, 0.016655, 0.016735, 0.019265, 0.019541, 0.022296, 0.023573, 0.025254, 0.025307, 0.025376, 0.027089, 0.029663, 0.032675, 0.035402, 0.036111, 0.038190, 0.039992, 0.036944, 0.036603, 0.034952, 0.034044, 0.033781, 0.032751, 0.033378, 0.031785
#*# 	-0.001366, 0.005728, 0.007959, 0.010613, 0.014404, 0.015139, 0.017073, 0.019142, 0.019933, 0.020959, 0.022037, 0.023704, 0.026164, 0.027515, 0.027986, 0.029432, 0.030688, 0.033804, 0.035983, 0.038102, 0.040764, 0.040356, 0.039299, 0.037813, 0.037580, 0.036198, 0.034245, 0.033757, 0.033496, 0.031446
#*# 	-0.014718, -0.006296, -0.004723, -0.002051, 0.002018, 0.004527, 0.006200, 0.008235, 0.010150, 0.010194, 0.010118, 0.012193, 0.014158, 0.014097, 0.014781, 0.015007, 0.017438, 0.020844, 0.025439, 0.029450, 0.027506, 0.026966, 0.027746, 0.026476, 0.024295, 0.023290, 0.022511, 0.021300, 0.020594, 0.019390
#*# 	-0.028811, -0.022365, -0.019832, -0.016554, -0.013101, -0.009433, -0.009090, -0.008204, -0.006700, -0.006886, -0.006725, -0.005711, -0.004166, -0.004167, -0.003723, -0.002929, -0.001863, 0.003777, 0.011596, 0.014503, 0.012204, 0.011054, 0.010429, 0.011377, 0.010055, 0.008492, 0.006092, 0.008016, 0.007041, 0.005103
#*# 	-0.043145, -0.035986, -0.033182, -0.030336, -0.027264, -0.024550, -0.024222, -0.022577, -0.022040, -0.022350, -0.022607, -0.021950, -0.020917, -0.020182, -0.019689, -0.018247, -0.017557, -0.013648, -0.005209, 0.006155, -0.001189, -0.007393, 0.001632, -0.002622, -0.001422, 0.001416, -0.003616, -0.003609, -0.004613, -0.002554
#*# 	-0.050894, -0.044170, -0.041926, -0.039430, -0.038497, -0.037259, -0.034795, -0.032365, -0.030929, -0.030911, -0.032160, -0.031454, -0.031021, -0.031691, -0.030815, -0.030543, -0.028983, -0.024129, -0.020429, -0.011253, -0.013557, -0.015920, -0.011203, -0.012142, -0.014020, -0.012512, -0.007540, -0.015586, -0.022253, -0.023891
#*# 	-0.050639, -0.043893, -0.039938, -0.037431, -0.037262, -0.037395, -0.034891, -0.032759, -0.032201, -0.032765, -0.032501, -0.033131, -0.032733, -0.032775, -0.032754, -0.032682, -0.031324, -0.027417, -0.024142, -0.021897, -0.018018, -0.022096, -0.022139, -0.026440, -0.024253, -0.022054, -0.016546, -0.011794, -0.024439, -0.026686
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 240.0
#*# min_y = 25.0
#*# max_y = 240.0
